# Controllable Time-delay Transformer VAD Realtime 模型介绍

# Highlights

* 中文标点vad实时模型：可用于实时语音识别模型输出文本的标点预测。
  * 基于[基于grpc服务](https://github.com/alibaba-damo-academy/FunASR/tree/main/funasr/runtime/python/grpc)场景的使用
  * 基于[FunASR框架](https://github.com/alibaba-damo-academy/FunASR)，可进行实时场景的ASR，VAD，标点的自由组合
  * 基于模拟vad的纯文本输入的标点预测

## **[FunASR开源项目介绍](https://github.com/alibaba-damo-academy/FunASR)**

**[FunASR](https://github.com/alibaba-damo-academy/FunASR)**希望在语音识别的学术研究和工业应用之间架起一座桥梁。通过发布工业级语音识别模型的训练和微调，研究人员和开发人员可以更方便地进行语音识别模型的研究和生产，并推动语音识别生态的发展。让语音识别更有趣！

[**github仓库**](https://github.com/alibaba-damo-academy/FunASR) | [**最新动态**](https://github.com/alibaba-damo-academy/FunASR#whats-new) | [**环境安装**](https://github.com/alibaba-damo-academy/FunASR#installation) | [**服务部署**](https://www.funasr.com/) | [**模型库**](https://github.com/alibaba-damo-academy/FunASR/tree/main/model_zoo) | [**联系我们**](https://github.com/alibaba-damo-academy/FunASR#contact)

## 模型原理介绍

Controllable Time-delay Transformer是达摩院语音团队提出的高效后处理框架中的标点模块。本项目为中文通用标点模型，模型可以被应用于文本类输入的标点预测，也可应用于语音识别结果的后处理步骤，协助语音识别模块输出具有可读性的文本结果。

![Controllable Time-delay Transformer模型结构](https://modelscope.cn/models/iic/punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727/resolve/master/fig/struct.png)

Controllable Time-delay Transformer 模型结构如上图所示，由 Embedding、Encoder 和 Predictor 三部分组成。Embedding 是词向量叠加位置向量。Encoder可以采用不同的网络结构，例如self-attention，conformer，SAN-M等。Predictor 预测每个token后的标点类型。

在模型的选择上采用了性能优越的Transformer模型。Transformer模型在获得良好性能的同时，由于模型自身序列化输入等特性，会给系统带来较大时延。常规的Transformer可以看到未来的全部信息，导致标点会依赖很远的未来信息。这会给用户带来一种标点一直在变化刷新，长时间结果不固定的不良感受。基于这一问题，我们创新性的提出了可控时延的Transformer模型（Controllable Time-Delay Transformer, CT-Transformer），在模型性能无损失的情况下，有效控制标点的延时。

更详细的细节见：

* 论文： [CONTROLLABLE TIME-DELAY TRANSFORMER FOR REAL-TIME PUNCTUATION PREDICTION AND DISFLUENCY DETECTION](https://arxiv.org/pdf/2003.01309.pdf)

#### 基于ModelScope进行推理

以下为三种支持格式及api调用方式参考如下范例：

* text.scp文件路径，例如example/punc_example.txt，格式为： key + "\t" + value

<pre><div class="acss-q09o5g"><div node="[object Object]"><code class="language-sh"><span><span>cat example/punc_example.txt
</span></span><span>1       跨境河流是养育沿岸人民的生命之源
</span><span>2       从存储上来说仅仅是全景图片它就会是图片的四倍的容量
</span><span>3       那今天的会就到这里吧happy new year明年见
</span><span></span></code></div><div class="acss-1wlnmrj"><span role="img" tabindex="-1" class="anticon acss-1sra2vo acss-yiit70"><svg width="1em" height="1em" fill="currentColor" aria-hidden="true" focusable="false" class=""><use xlink:href="#icon-maasfuzhi-copy-line"></use></svg></span><div data-autolog="clk=true&exp=true&c3=notebook&c4=openNotebookDrawerFree&c5=%7B%22source%22%3A%22codeBlock%22%2C%22inNotebook%22%3Afalse%7D" autolog-exp-hash="8d692f6da56d4b" autolog-exp-reported="1"></div></div></div></pre>

<pre><div class="acss-q09o5g"><div node="[object Object]"><code class="language-python"><span><span>from</span><span> modelscope.pipelines </span><span>import</span><span> pipeline
</span></span><span><span></span><span>from</span><span> modelscope.utils.constant </span><span>import</span><span> Tasks
</span></span><span>
</span><span>inference_pipeline = pipeline(
</span><span>    task=Tasks.punctuation,
</span><span><span>    model=</span><span>'iic/punc_ct-transformer_zh-cn-common-vad_realtime-vocab272727'</span><span>,
</span></span><span><span>    model_revision=</span><span>"v2.0.4"</span><span>)
</span></span><span>
</span><span><span>inputs = </span><span>"跨境河流是养育沿岸|人民的生命之源长期以来为帮助下游地区防灾减灾中方技术人员|在上游地区极为恶劣的自然条件下克服巨大困难甚至冒着生命危险|向印方提供汛期水文资料处理紧急事件中方重视印方在跨境河流问题上的关切|愿意进一步完善双方联合工作机制|凡是|中方能做的我们|都会去做而且会做得更好我请印度朋友们放心中国在上游的|任何开发利用都会经过科学|规划和论证兼顾上下游的利益"</span><span>
</span></span><span><span>vads = inputs.split(</span><span>"|"</span><span>)
</span></span><span>
</span><span><span>rec_result_all=</span><span>"outputs: "</span><span>
</span></span><span>cache = {}
</span><span><span></span><span>for</span><span> vad </span><span>in</span><span> vads:
</span></span><span>    rec_result = inference_pipeline(vad, cache=cache)
</span><span><span>    rec_result_all += rec_result[</span><span>0</span><span>][</span><span>'text'</span><span>]
</span></span><span>
</span><span><span></span><span>print</span><span>(rec_result_all)</span></span></code></div></div></pre>
