openapi: 3.0.3
info:
  title: è¯­éŸ³è¯†åˆ«APIæœåŠ¡
  description: |
    åŸºäºFunASRçš„æ™ºèƒ½è¯­éŸ³è¯†åˆ«APIæœåŠ¡
    
    **æ ¸å¿ƒåŠŸèƒ½ï¼š**
    - ğŸš€ Paraformer å®æ—¶æµå¼è¯†åˆ«ï¼ˆé€Ÿåº¦å¿«ï¼‰
    - âœ¨ SenseVoice å®Œæ•´éŸ³é¢‘è¯†åˆ«ï¼ˆå‡†ç¡®åº¦é«˜ï¼‰
    - ğŸ¤– LLM æ™ºèƒ½åˆå¹¶çº é”™ï¼ˆè´¨é‡æœ€ä¼˜ï¼‰
    
    **æŠ€æœ¯æ ˆï¼š**
    - ASRæ¨¡å‹: paraformer-zh-streaming
    - æ ‡ç‚¹æ¨¡å‹: ct-punc
    - å¤æ£€æ¨¡å‹: iic/SenseVoiceSmall
    - LLMæ¨¡å‹: qwen3:8b
    
    **ä½¿ç”¨å»ºè®®ï¼š**
    - ä¼˜å…ˆä½¿ç”¨ llm_merged ç»“æœï¼ˆç»¼åˆæœ€ä¼˜ï¼‰
    - éœ€è¦å¿«é€Ÿç»“æœæ—¶ä½¿ç”¨ paraformer
    - éœ€è¦é«˜å‡†ç¡®åº¦æ—¶ä½¿ç”¨ sensevoice
    
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5006
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: http://10.8.75.207:5006
    description: å†…ç½‘æµ‹è¯•æœåŠ¡å™¨

tags:
  - name: ç³»ç»Ÿç®¡ç†
    description: ç³»ç»Ÿå¥åº·æ£€æŸ¥å’ŒçŠ¶æ€æŸ¥è¯¢
  - name: è¯­éŸ³è¯†åˆ«
    description: éŸ³é¢‘è½¬å½•ç›¸å…³æ¥å£
  - name: æ¨¡å‹ä¿¡æ¯
    description: æ¨¡å‹é…ç½®å’Œæ”¯æŒæ ¼å¼æŸ¥è¯¢

paths:
  /api/health:
    get:
      tags:
        - ç³»ç»Ÿç®¡ç†
      summary: å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œæ¨¡å‹æ˜¯å¦å·²åŠ è½½
      operationId: healthCheck
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                    description: æœåŠ¡çŠ¶æ€
                  message:
                    type: string
                    example: ASR APIæœåŠ¡æ­£å¸¸è¿è¡Œ
                  models_loaded:
                    type: boolean
                    example: true
                    description: æ¨¡å‹æ˜¯å¦å·²åŠ è½½
              examples:
                success:
                  summary: æœåŠ¡æ­£å¸¸
                  value:
                    status: ok
                    message: ASR APIæœåŠ¡æ­£å¸¸è¿è¡Œ
                    models_loaded: true

  /api/asr/transcribe:
    post:
      tags:
        - è¯­éŸ³è¯†åˆ«
      summary: éŸ³é¢‘è½¬å½•
      description: |
        ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶è¿›è¡Œè½¬å½•ï¼Œè¿”å›ä¸‰ç§è¯†åˆ«ç»“æœçš„å¯¹æ¯”ï¼š
        
        1. **Paraformer**: å®æ—¶æµå¼è¯†åˆ«ï¼Œé€Ÿåº¦å¿«ä½†å‡†ç¡®åº¦ç›¸å¯¹è¾ƒä½
        2. **SenseVoice**: å®Œæ•´éŸ³é¢‘è¯†åˆ«ï¼Œå‡†ç¡®åº¦é«˜ï¼Œè´¨é‡å¯é 
        3. **LLMåˆå¹¶**: æ™ºèƒ½åˆå¹¶ä¸¤ç§ç»“æœï¼Œå‡†ç¡®åº¦æœ€é«˜ï¼ˆæ¨èä½¿ç”¨ï¼‰
        
        **æ”¯æŒçš„éŸ³é¢‘æ ¼å¼**: wav, mp3, ogg, flac, m4a, aac, wma
        
        **å¯é€‰å‚æ•°**:
        - hotwords: ä¸“ä¸šè¯æ±‡ï¼Œå¤šä¸ªè¯æ±‡ç”¨é€—å·åˆ†éš”ï¼ŒLLMä¼šä¼˜å…ˆä½¿ç”¨è¿™äº›è¯æ±‡
      operationId: transcribeAudio
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: éŸ³é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒ wav, mp3, ogg, flac, m4a, aac, wmaï¼‰
                hotwords:
                  type: string
                  description: ä¸“ä¸šè¯æ±‡ï¼Œå¤šä¸ªè¯æ±‡ç”¨é€—å·åˆ†éš”ï¼ˆå¯é€‰ï¼‰
                  example: ä¼šè®®çºªè¦,å®æ—¶è½¬å½•,è¯­éŸ³è¯†åˆ«
            examples:
              basic:
                summary: åŸºç¡€è½¬å½•ï¼ˆæ— çƒ­è¯ï¼‰
                value:
                  file: (binary)
              with_hotwords:
                summary: å¸¦çƒ­è¯çš„è½¬å½•
                value:
                  file: (binary)
                  hotwords: ä¼šè®®çºªè¦,å®æ—¶è½¬å½•,è¯­éŸ³è¯†åˆ«,FunASR
      responses:
        '200':
          description: è½¬å½•æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      paraformer:
                        type: object
                        properties:
                          text:
                            type: string
                            description: Paraformerè¯†åˆ«ç»“æœ
                          length:
                            type: integer
                            description: æ–‡æœ¬å­—æ•°
                      sensevoice:
                        type: object
                        properties:
                          text:
                            type: string
                            description: SenseVoiceè¯†åˆ«ç»“æœ
                          length:
                            type: integer
                            description: æ–‡æœ¬å­—æ•°
                      llm_merged:
                        type: object
                        properties:
                          text:
                            type: string
                            description: LLMæ™ºèƒ½åˆå¹¶ç»“æœï¼ˆæ¨èä½¿ç”¨ï¼‰
                          length:
                            type: integer
                            description: æ–‡æœ¬å­—æ•°
                  filename:
                    type: string
                    description: ä¸Šä¼ çš„æ–‡ä»¶å
                  hotwords:
                    type: array
                    items:
                      type: string
                    nullable: true
                    description: ä½¿ç”¨çš„çƒ­è¯åˆ—è¡¨
              examples:
                success:
                  summary: è½¬å½•æˆåŠŸç¤ºä¾‹
                  value:
                    success: true
                    data:
                      paraformer:
                        text: æµ‹è¯•ä¸€æµ‹è¯•äºŒä¼šè®®çºªè¦ä¸€ä¼šè®®çºªè¦äºŒä¼šè®®çºªè¦ä¸‰
                        length: 22
                      sensevoice:
                        text: æµ‹è¯•ä¸€ã€æµ‹è¯•äºŒï¼Œä¼šè®®çºªè¦ä¸€ã€ä¼šè®®çºªè¦äºŒã€ä¼šè®®çºªè¦ä¸‰ã€‚
                        length: 27
                      llm_merged:
                        text: æµ‹è¯•ä¸€ã€æµ‹è¯•äºŒï¼Œä¼šè®®çºªè¦ä¸€ã€ä¼šè®®çºªè¦äºŒã€ä¼šè®®çºªè¦ä¸‰ã€‚
                        length: 27
                    filename: test_audio.wav
                    hotwords: 
                      - ä¼šè®®çºªè¦
                      - å®æ—¶è½¬å½•
        '400':
          description: è¯·æ±‚é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                no_file:
                  summary: æœªä¸Šä¼ æ–‡ä»¶
                  value:
                    success: false
                    error: æœªæ‰¾åˆ°ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ 'file' å­—æ®µä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
                empty_filename:
                  summary: æ–‡ä»¶åä¸ºç©º
                  value:
                    success: false
                    error: æ–‡ä»¶åä¸ºç©º
                invalid_format:
                  summary: ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
                  value:
                    success: false
                    error: ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œæ”¯æŒçš„æ ¼å¼: wav, mp3, ogg, flac, m4a, aac, wma
        '500':
          description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                processing_error:
                  summary: å¤„ç†é”™è¯¯
                  value:
                    success: false
                    error: Paraformerè¯†åˆ«å¤±è´¥: éŸ³é¢‘æ ¼å¼è§£æé”™è¯¯

  /api/asr/models:
    get:
      tags:
        - æ¨¡å‹ä¿¡æ¯
      summary: è·å–æ¨¡å‹ä¿¡æ¯
      description: æŸ¥è¯¢å½“å‰ä½¿ç”¨çš„ASRæ¨¡å‹ã€æ ‡ç‚¹æ¨¡å‹ã€SenseVoiceæ¨¡å‹å’ŒLLMæ¨¡å‹çš„ä¿¡æ¯
      operationId: getModelsInfo
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      asr_model:
                        type: string
                        example: paraformer-zh-streaming
                        description: ASRæ¨¡å‹åç§°
                      punc_model:
                        type: string
                        example: ct-punc
                        description: æ ‡ç‚¹æ¨¡å‹åç§°
                      sensevoice_model:
                        type: string
                        example: iic/SenseVoiceSmall
                        description: SenseVoiceæ¨¡å‹åç§°
                      llm_model:
                        type: string
                        example: qwen3:8b
                        description: LLMæ¨¡å‹åç§°
                      models_loaded:
                        type: boolean
                        example: true
                        description: æ¨¡å‹æ˜¯å¦å·²åŠ è½½
              examples:
                success:
                  summary: æ¨¡å‹ä¿¡æ¯
                  value:
                    success: true
                    data:
                      asr_model: paraformer-zh-streaming
                      punc_model: ct-punc
                      sensevoice_model: iic/SenseVoiceSmall
                      llm_model: qwen3:8b
                      models_loaded: true

  /api/asr/formats:
    get:
      tags:
        - æ¨¡å‹ä¿¡æ¯
      summary: è·å–æ”¯æŒçš„éŸ³é¢‘æ ¼å¼
      description: æŸ¥è¯¢APIæ”¯æŒçš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼åˆ—è¡¨
      operationId: getSupportedFormats
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      formats:
                        type: array
                        items:
                          type: string
                        example: 
                          - wav
                          - mp3
                          - ogg
                          - flac
                          - m4a
                          - aac
                          - wma
                      description:
                        type: string
                        example: æ”¯æŒçš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼
              examples:
                success:
                  summary: æ”¯æŒçš„æ ¼å¼
                  value:
                    success: true
                    data:
                      formats:
                        - wav
                        - mp3
                        - ogg
                        - flac
                        - m4a
                        - aac
                        - wma
                      description: æ”¯æŒçš„éŸ³é¢‘æ–‡ä»¶æ ¼å¼

components:
  schemas:
    Error:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: é”™è¯¯ä¿¡æ¯
          example: æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ
    
    TranscriptionResult:
      type: object
      properties:
        text:
          type: string
          description: è¯†åˆ«çš„æ–‡æœ¬å†…å®¹
        length:
          type: integer
          description: æ–‡æœ¬å­—æ•°
      required:
        - text
        - length
